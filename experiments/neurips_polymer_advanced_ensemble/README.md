# NeurIPS Polymer Advanced Ensemble Experiment

## æ¦‚è¦

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€NeurIPS Open Polymer Prediction 2025ã‚³ãƒ³ãƒšãƒ†ã‚£ã‚·ãƒ§ãƒ³ç”¨ã®é«˜åº¦ãªã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å®Ÿé¨“ã‚’ç®¡ç†ã—ã¾ã™ã€‚æœ€å…ˆç«¯ã®ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æ‰‹æ³•ã¨åˆ†å­ç‰¹å¾´é‡ã‚’çµ„ã¿åˆã‚ã›ãŸé«˜ç²¾åº¦äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
experiments/neurips_polymer_advanced_ensemble/
â”œâ”€â”€ README.md                           # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ config.yaml                         # å®Ÿé¨“è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ scripts/                           # å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ local_experiment.py            # ãƒ¡ã‚¤ãƒ³å®Ÿé¨“ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ local_polymer_prediction.py    # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³äº’æ›ç‰ˆ
â”‚   â””â”€â”€ run_experiment.sh              # å®Ÿè¡Œã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ tests/                             # ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ quick_test.py                   # ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ wandb_test.py                   # WandBãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ model_test.py                   # ãƒ¢ãƒ‡ãƒ«æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ experiments_results/               # å®Ÿé¨“çµæœ
â”‚   â””â”€â”€ advanced_ensemble_[ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—]/  # å®Ÿè¡Œæ™‚ã«è‡ªå‹•ç”Ÿæˆ
â”‚       â”œâ”€â”€ metadata.json             # å®Ÿé¨“ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â”‚       â”œâ”€â”€ config_used.yaml          # ä½¿ç”¨ã—ãŸè¨­å®š
â”‚       â”œâ”€â”€ models/                   # è¨“ç·´æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«
â”‚       â”œâ”€â”€ predictions/              # äºˆæ¸¬çµæœ
â”‚       â”‚   â””â”€â”€ submission.csv        # Kaggleæå‡ºç”¨ãƒ•ã‚¡ã‚¤ãƒ«
â”‚       â””â”€â”€ logs/                     # è©³ç´°ãƒ­ã‚°
â”œâ”€â”€ results/                          # æ—§å½¢å¼ã®çµæœï¼ˆç§»è¡Œä¸­ï¼‰
â””â”€â”€ wandb/                            # WandBå®Ÿé¨“ãƒ­ã‚°
    â””â”€â”€ [WandBå®Ÿé¨“ãƒ‡ãƒ¼ã‚¿]
```

## ä¸»ãªæ©Ÿèƒ½

### ğŸ§¬ é«˜åº¦ãªåˆ†å­ç‰¹å¾´é‡ç”Ÿæˆ
- **RDKitå®Œå…¨ç‰¹å¾´ã‚»ãƒƒãƒˆ**: 
  - å…¨è¨˜è¿°å­ï¼ˆ500+ç‰¹å¾´é‡ï¼‰
  - Morganãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆï¼ˆ256ãƒ“ãƒƒãƒˆï¼‰
  - MACCSã‚­ãƒ¼ï¼ˆ167ãƒ“ãƒƒãƒˆï¼‰
  - ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒãƒ¼ç‰¹å¾´é‡
- **ç‰¹å¾´é‡é¸æŠ**: 
  - ç‰¹æ€§åˆ¥ã®é‡è¦ç‰¹å¾´é‡è‡ªå‹•é¸æŠ
  - ç›¸é–¢åˆ†æã«ã‚ˆã‚‹å†—é•·æ€§å‰Šæ¸›

### ğŸ¤– æœ€å…ˆç«¯ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«
- **XGBoost**: ç‰¹æ€§åˆ¥æœ€é©åŒ–æ¸ˆã¿ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- **CatBoost**: ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«ç‰¹å¾´é‡å¯¾å¿œ
- **Random Forest**: å®‰å®šæ€§é‡è¦–ã®ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«
- **Gradient Boosting**: è¿½åŠ ã®å¤šæ§˜æ€§ç¢ºä¿
- **K-NN**: å°ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç”¨è£œå®Œãƒ¢ãƒ‡ãƒ«
- **ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æˆ¦ç•¥**: 
  - åŠ é‡å¹³å‡ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«
  - ã‚¹ã‚¿ãƒƒã‚­ãƒ³ã‚°ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### ğŸ“Š å®Ÿé¨“ç®¡ç†
- **è‡ªå‹•ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ**: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãå®Ÿé¨“ãƒ•ã‚©ãƒ«ãƒ€
- **åŒ…æ‹¬çš„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**: 
  - ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ï¼ˆCVã€ç‰¹æ€§åˆ¥ï¼‰
  - ä½¿ç”¨è¨­å®šã®å®Œå…¨è¨˜éŒ²
  - å®Ÿè¡Œç’°å¢ƒæƒ…å ±
- **çµæœã®æ•´ç†**: 
  - ãƒ¢ãƒ‡ãƒ«ã€äºˆæ¸¬ã€ãƒ­ã‚°ã®åˆ†é›¢ä¿å­˜
  - å†ç¾å¯èƒ½ãªå®Ÿé¨“è¨­å®š

## ä½¿ç”¨æ–¹æ³•

### å‰ææ¡ä»¶

1. **ãƒ‡ãƒ¼ã‚¿æº–å‚™**: `data/raw/`ã«ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®
   ```
   data/raw/
   â”œâ”€â”€ train.csv
   â”œâ”€â”€ test.csv
   â””â”€â”€ sample_submission.csv
   ```

2. **ä¾å­˜é–¢ä¿‚**: 
   ```bash
   # å¿…é ˆ
   pip install pandas numpy scikit-learn xgboost catboost matplotlib seaborn pyyaml
   
   # å¼·ãæ¨å¥¨ï¼ˆé«˜ç²¾åº¦äºˆæ¸¬å¿…é ˆï¼‰
   pip install rdkit-pypi
   
   # ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿé¨“ç®¡ç†ï¼‰
   pip install wandb
   ```

### å®Ÿè¡Œ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œ
cd neurips-open-polymer-prediction-2025

# åŸºæœ¬å®Ÿé¨“
./experiments/neurips_polymer_advanced_ensemble/scripts/run_experiment.sh

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œå®Ÿè¡Œ
./experiments/neurips_polymer_advanced_ensemble/scripts/run_experiment.sh --install

# RDKitå«ã‚€å®Œå…¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œå®Ÿè¡Œ
./experiments/neurips_polymer_advanced_ensemble/scripts/run_experiment.sh --rdkit

# WandBçµ±åˆå®Ÿé¨“
./experiments/neurips_polymer_advanced_ensemble/scripts/run_experiment.sh --wandb

# ç›´æ¥Pythonå®Ÿè¡Œ
python experiments/neurips_polymer_advanced_ensemble/scripts/local_experiment.py
python experiments/neurips_polymer_advanced_ensemble/scripts/local_experiment.py --use-wandb
```

### å‡ºåŠ›

å®Ÿè¡Œå¾Œã€ä»¥ä¸‹ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```
experiments/neurips_polymer_advanced_ensemble/experiments_results/advanced_ensemble_YYYYMMDD_HHMMSS/
â”œâ”€â”€ metadata.json        # å®Ÿé¨“è¨­å®šãƒ»çµæœã®å®Œå…¨è¨˜éŒ²
â”œâ”€â”€ config_used.yaml     # ä½¿ç”¨ã—ãŸè¨­å®šã®ã‚³ãƒ”ãƒ¼
â”œâ”€â”€ models/              # è¨“ç·´æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ï¼ˆ.pklå½¢å¼ï¼‰
â”‚   â”œâ”€â”€ Tg_models.pkl
â”‚   â”œâ”€â”€ e_models.pkl
â”‚   â””â”€â”€ ...
â”œâ”€â”€ predictions/         # äºˆæ¸¬çµæœ
â”‚   â”œâ”€â”€ submission.csv   # Kaggleæå‡ºç”¨äºˆæ¸¬ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ cv_predictions.csv # ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³äºˆæ¸¬
â””â”€â”€ logs/                # è©³ç´°ãƒ­ã‚°
    â”œâ”€â”€ experiment.log   # å®Ÿè¡Œãƒ­ã‚°
    â””â”€â”€ feature_importance.json # ç‰¹å¾´é‡é‡è¦åº¦
```

## è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³

`config.yaml`ã§ä»¥ä¸‹ã®è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼š

```yaml
experiment:
  name: "advanced_ensemble"
  seed: 42
  cv_folds: 5

features:
  use_rdkit: true
  max_features: 500
  feature_selection: true

models:
  xgboost:
    enabled: true
    n_estimators: 1000
    learning_rate: 0.01
  catboost:
    enabled: true
    iterations: 1000
    learning_rate: 0.03
  # ... ãã®ä»–ãƒ¢ãƒ‡ãƒ«è¨­å®š

ensemble:
  method: "weighted_average"  # or "stacking"
  optimize_weights: true
```

## æ€§èƒ½æŒ‡æ¨™

- **è©•ä¾¡æŒ‡æ¨™**: wMAEï¼ˆé‡ã¿ä»˜ãå¹³å‡çµ¶å¯¾èª¤å·®ï¼‰
- **æ¤œè¨¼**: 5-Fold ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **ç‰¹æ€§åˆ¥è©•ä¾¡**: å„ãƒãƒªãƒãƒ¼ç‰¹æ€§ã®å€‹åˆ¥æ€§èƒ½
- **æœŸå¾…æ€§èƒ½**: 
  - CV wMAE: ~2.0-2.5ï¼ˆãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚ˆã‚Šæ”¹å–„ï¼‰
  - å®Ÿè¡Œæ™‚é–“: 30-60åˆ†ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã€RDKitä½¿ç”¨æ™‚ï¼‰

## ãƒ­ã‚°å‡ºåŠ›ä¾‹

```
ğŸš€ å®Ÿé¨“é–‹å§‹: advanced_ensemble_20250624_150000
âœ… è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†: config.yaml
âœ… RDKitåˆ©ç”¨å¯èƒ½ - é«˜ç²¾åº¦åˆ†å­ç‰¹å¾´é‡ã‚’ä½¿ç”¨
ğŸ“‚ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...
ğŸ§¬ é«˜åº¦ãªåˆ†å­ç‰¹å¾´é‡ç”Ÿæˆä¸­...
  - RDKitè¨˜è¿°å­: 500 ç‰¹å¾´é‡
  - Morganãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ: 256 ãƒ“ãƒƒãƒˆ
  - MACCSã‚­ãƒ¼: 167 ãƒ“ãƒƒãƒˆ
ğŸ¤– ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«è¨“ç·´é–‹å§‹...
  Tg ç”¨ã®é«˜åº¦ãªãƒ¢ãƒ‡ãƒ«è¨“ç·´ä¸­...
  ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ 1:
    - XGBoost MAE: 43.567
    - CatBoost MAE: 42.890
    - ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ« MAE: 42.234
ğŸ¯ æ¨å®šé‡ã¿ä»˜ãMAE: 2.123
ğŸ’¾ ãƒ¢ãƒ‡ãƒ«ã¨çµæœã‚’ä¿å­˜ä¸­...
â±ï¸  ç·å®Ÿè¡Œæ™‚é–“: 45.67 åˆ†
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### RDKitã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼
```bash
# ä»£æ›¿ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
conda install -c conda-forge rdkit
# ã¾ãŸã¯ç’°å¢ƒã‚’åˆ†ã‘ã¦
conda create -n polymer-pred python=3.9 rdkit
conda activate polymer-pred
```

### ãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ç‰¹å¾´é‡æ•°ã‚’å‰Šæ¸›ï¼š`max_features: 200`
- ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´ï¼š`n_estimators`ã‚’å‰Šæ¸›
- ä¸€éƒ¨ã®ãƒ¢ãƒ‡ãƒ«ã‚’ç„¡åŠ¹åŒ–ï¼š`enabled: false`

### å®Ÿè¡Œæ™‚é–“ãŒé•·ã„
- ä¸¦åˆ—å‡¦ç†ã®ç¢ºèªï¼š`n_jobs: -1`
- CVãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰æ•°ã®å‰Šæ¸›ï¼š`cv_folds: 3`
- æ—©æœŸåœæ­¢ã®æœ‰åŠ¹åŒ–ï¼š`early_stopping_rounds: 50`

## å®Ÿé¨“ã®æ¯”è¼ƒãƒ»åˆ†æ

å®Ÿé¨“çµæœã¯`metadata.json`ã«è©³ç´°ã«è¨˜éŒ²ã•ã‚Œã€è¤‡æ•°å®Ÿé¨“ã®æ¯”è¼ƒãŒå¯èƒ½ï¼š

```json
{
  "experiment_name": "advanced_ensemble_20250624_150000",
  "config_file": "config.yaml",
  "rdkit_available": true,
  "feature_stats": {
    "total_features": 923,
    "selected_features": 500
  },
  "model_info": {
    "Tg": {
      "cv_scores": [43.2, 42.8, 43.5, 42.1, 43.0],
      "mean_cv_score": 42.92,
      "ensemble_method": "weighted_average",
      "model_weights": {
        "xgboost": 0.35,
        "catboost": 0.40,
        "random_forest": 0.15,
        "gradient_boosting": 0.10
      }
    }
  },
  "estimated_wmae": 2.123,
  "execution_time_minutes": 45.67
}
```

## Kaggleãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯å¤‰æ›

ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿé¨“ã‚’Kaggleãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã«å¤‰æ›ï¼š

```bash
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰å®Ÿè¡Œ
cd workflows
python local_to_kaggle.py neurips_polymer_advanced_ensemble
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–**: 
   - Optunaã«ã‚ˆã‚‹è‡ªå‹•èª¿æ•´
   - ãƒ™ã‚¤ã‚ºæœ€é©åŒ–ã®å®Ÿè£…

2. **ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°æ”¹å–„**: 
   - ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã«åŸºã¥ãæ–°ç‰¹å¾´é‡
   - å¤–éƒ¨åŒ–å­¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ´»ç”¨

3. **ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æ‰‹æ³•ã®é«˜åº¦åŒ–**: 
   - ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚¿ãƒƒã‚­ãƒ³ã‚°
   - å‹•çš„é‡ã¿ä»˜ã‘æˆ¦ç•¥

4. **å®Ÿé¨“è‡ªå‹•åŒ–**: 
   - ã‚°ãƒªãƒƒãƒ‰ã‚µãƒ¼ãƒã®ä¸¦åˆ—å®Ÿè¡Œ
   - çµæœã®è‡ªå‹•åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

## è²¢çŒ®è€…å‘ã‘ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- æ–°ã—ã„å®Ÿé¨“ã¯ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¾“ã£ã¦ä½œæˆ
- å®Ÿé¨“çµæœã¯å¿…ãš`experiments_results/`ã«ä¿å­˜
- è¨­å®šå¤‰æ›´ã¯`config.yaml`ã§ç®¡ç†
- é‡è¦ãªå¤‰æ›´ã¯`metadata.json`ã«è¨˜éŒ²